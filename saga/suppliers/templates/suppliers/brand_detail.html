{% extends 'base.html' %}
{% load static %}
{% load product_tags %}

{% block title %}{{ brand }} - BoliBana {% endblock %}

{% block content %}
<div class="bg-gray-50">
    <div class="mx-auto max-w-6xl px-4 sm:px-6 py-12 sm:py-20 lg:max-w-8xl xl:max-w-full xl:px-16">
        <!-- Breadcrumb -->
        <div class="mb-8">
            {% include "suppliers/components/breadcrumb.html" %}
        </div>

        <!-- En-tête -->
        <div class="relative mb-16">
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-extrabold font-bitter bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent drop-shadow-sm mb-2">
                {{ brand }}
            </h1>
            <div class="absolute -bottom-2 left-0 w-32 h-1.5 bg-gradient-to-r from-green-600 via-yellow-500 to-red-500 rounded-full"></div>
        </div>

        <!-- Barre de filtres mobile -->
        <div class="mt-8 mb-8 md:hidden">
            <form method="get" id="mobileFiltersForm">
                <!-- Champs cachés pour préserver les autres filtres -->
                {% if selected_price_min %}
                <input type="hidden" name="price_min" value="{{ selected_price_min }}">
                {% endif %}
                {% if selected_price_max %}
                <input type="hidden" name="price_max" value="{{ selected_price_max }}">
                {% endif %}
                {% if selected_brand %}
                <input type="hidden" name="brand" value="{{ selected_brand }}">
                {% endif %}
                {% if selected_model %}
                <input type="hidden" name="model" value="{{ selected_model }}">
                {% endif %}
                {% if selected_storage %}
                <input type="hidden" name="storage" value="{{ selected_storage }}">
                {% endif %}
                {% if selected_ram %}
                <input type="hidden" name="ram" value="{{ selected_ram }}">
                {% endif %}
                {% if selected_sort %}
                <input type="hidden" name="sort" value="{{ selected_sort }}">
                {% endif %}
                
                <div class="bg-white border border-gray-200 rounded-lg shadow-sm">
                    <div class="flex items-center justify-around py-3 px-4">
                        <!-- Section Promo -->
                        <div class="flex items-center space-x-2">
                            <input type="checkbox" name="promotion" id="promo_quick" value="yes" 
                                   {% if selected_promotion == 'yes' %}checked{% endif %}
                                   class="w-4 h-4 text-green-600 focus:ring-green-500 border-gray-300 rounded"
                                   onchange="submitMobileForm()">
                            <label for="promo_quick" class="text-sm text-gray-700 font-medium">Promo</label>
                            <svg class="w-4 h-4 text-red-500" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z" clip-rule="evenodd"/>
                            </svg>
                        </div>

                        <!-- Séparateur -->
                        <div class="w-px h-6 bg-gray-300"></div>

                        <!-- Section Filtrer -->
                        <button type="button" onclick="toggleFilters()" class="flex items-center space-x-2 text-gray-700">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
                            </svg>
                            <span class="text-sm font-medium">Filtrer</span>
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <!-- Filtres Desktop -->
        <div class="hidden md:block mb-12">
            <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mx-2 sm:mx-0">
                <form class="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 gap-3 sm:gap-4"
                      method="get"
                      id="filtersForm">
                    <!-- Filtres de prix -->
                    <div class="space-y-1">
                        <input type="number" name="price_min" placeholder="Prix min" 
                               value="{{ selected_price_min }}"
                               class="w-full text-sm rounded-lg border border-gray-200 px-2 py-1.5 text-gray-700 focus:outline-none focus:ring-1 focus:ring-green-500 font-bitter">
                    </div>
                    <div class="space-y-1">
                        <input type="number" name="price_max" placeholder="Prix max" 
                               value="{{ selected_price_max }}"
                               class="w-full text-sm rounded-lg border border-gray-200 px-2 py-1.5 text-gray-700 focus:outline-none focus:ring-1 focus:ring-green-500 font-bitter">
                    </div>

                    <!-- Filtres de livraison -->
                    <div class="space-y-1">
                        <select name="shipping" class="w-full text-sm rounded-lg border border-gray-200 px-2 py-1.5 text-gray-700 focus:outline-none focus:ring-1 focus:ring-green-500 font-bitter">
                            <option value="">Livraison</option>
                            {% for method in shipping_methods %}
                            <option value="{{ method.name }}" {% if method.name == selected_shipping %}selected{% endif %}>
                                {{ method.name }} ({{ method.price|floatformat:0 }} FCFA - {{ method.get_delivery_time }})
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Filtres communs -->
                    <div class="space-y-1">
                        <select name="condition" class="w-full text-sm rounded-lg border border-gray-200 px-2 py-1.5 text-gray-700 focus:outline-none focus:ring-1 focus:ring-green-500 font-bitter">
                            <option value="">État</option>
                            <option value="new" {% if selected_condition == 'new' %}selected{% endif %}>Neuf</option>
                            <option value="used" {% if selected_condition == 'used' %}selected{% endif %}>Occasion</option>
                            <option value="refurbished" {% if selected_condition == 'refurbished' %}selected{% endif %}>Reconditionné</option>
                        </select>
                    </div>

                    <div class="space-y-1">
                        <select name="warranty" class="w-full text-sm rounded-lg border border-gray-200 px-2 py-1.5 text-gray-700 focus:outline-none focus:ring-1 focus:ring-green-500 font-bitter">
                            <option value="">Garantie</option>
                            <option value="yes" {% if selected_warranty == 'yes' %}selected{% endif %}>Avec garantie</option>
                            <option value="no" {% if selected_warranty == 'no' %}selected{% endif %}>Sans garantie</option>
                        </select>
                    </div>

                    <div class="space-y-1">
                        <select name="promotion" class="w-full text-sm rounded-lg border border-gray-200 px-2 py-1.5 text-gray-700 focus:outline-none focus:ring-1 focus:ring-green-500 font-bitter">
                            <option value="">Promo</option>
                            <option value="yes" {% if selected_promotion == 'yes' %}selected{% endif %}>En promo</option>
                            <option value="no" {% if selected_promotion == 'no' %}selected{% endif %}>Sans promo</option>
                        </select>
                    </div>

                    <!-- Menu de tri -->
                    <div class="space-y-1">
                        <select name="sort" class="w-full text-sm rounded-lg border border-gray-200 px-2 py-1.5 text-gray-700 focus:outline-none focus:ring-1 focus:ring-green-500 font-bitter">
                            <option value="">Trier par</option>
                            <option value="price_asc" {% if selected_sort == 'price_asc' %}selected{% endif %}>Prix croissant</option>
                            <option value="price_desc" {% if selected_sort == 'price_desc' %}selected{% endif %}>Prix décroissant</option>
                            <option value="new" {% if selected_sort == 'new' %}selected{% endif %}>Nouveautés</option>
                            <option value="best_selling" {% if selected_sort == 'best_selling' %}selected{% endif %}>Meilleures ventes</option>
                        </select>
                    </div>

                    <!-- Filtres spécifiques aux téléphones -->
                    {% if models %}
                    <div class="space-y-1">
                        <select name="model" class="w-full text-sm rounded-lg border border-gray-200 px-2 py-1.5 text-gray-700 focus:outline-none focus:ring-1 focus:ring-green-500 font-bitter">
                            <option value="">Modèle</option>
                            {% for model in models %}
                            <option value="{{ model.phone__model }}" {% if model.phone__model == selected_model %}selected{% endif %}>
                                {{ model.phone__model }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    {% endif %}

                    {% if storages %}
                    <div class="space-y-1">
                        <select name="storage" class="w-full text-sm rounded-lg border border-gray-200 px-2 py-1.5 text-gray-700 focus:outline-none focus:ring-1 focus:ring-green-500 font-bitter">
                            <option value="">Stockage</option>
                            {% for storage in storages %}
                            <option value="{{ storage.phone__storage }}" {% if storage.phone__storage == selected_storage %}selected{% endif %}>
                                {{ storage.phone__storage }} GB
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    {% endif %}

                    {% if rams %}
                    <div class="space-y-1">
                        <select name="ram" class="w-full text-sm rounded-lg border border-gray-200 px-2 py-1.5 text-gray-700 focus:outline-none focus:ring-1 focus:ring-green-500 font-bitter">
                            <option value="">RAM</option>
                            {% for ram in rams %}
                            <option value="{{ ram.phone__ram }}" {% if ram.phone__ram == selected_ram %}selected{% endif %}>
                                {{ ram.phone__ram }} GB
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    {% endif %}

                    <!-- Bouton de soumission -->
                    <div class="col-span-2 sm:col-span-4 md:col-span-6 flex flex-col sm:flex-row justify-end gap-2 sm:gap-3">
                        <button type="submit" 
                                class="w-full sm:w-auto inline-flex items-center justify-center px-3 sm:px-4 py-2 sm:py-2.5 bg-green-600 text-white text-xs sm:text-sm font-medium rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md font-bitter">
                            <svg class="w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1.5 sm:mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
                            </svg>
                            <span class="whitespace-nowrap font-bitter">Filtrer</span>
                        </button>
                        <a href="{% url 'suppliers:brand_detail' brand|slugify %}" 
                           class="w-full sm:w-auto inline-flex items-center justify-center px-3 sm:px-4 py-2 sm:py-2.5 bg-gray-100 text-gray-700 text-xs sm:text-sm font-medium rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md font-bitter">
                            <svg class="w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1.5 sm:mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                            </svg>
                            <span class="whitespace-nowrap font-bitter">Reset</span>
                        </a>
                    </div>
                </form>
            </div>
        </div>



        <!-- Grille des produits -->
                        <div id="phone-grid" class="grid grid-cols-2 gap-3 sm:gap-6 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5">
            {% for product in products %}
                {% render_product_card product %}
            {% empty %}
            <div class="col-span-full text-center py-16">
                <p class="text-gray-500 text-xl">Aucun produit disponible pour le moment.</p>
                <a href="{% url 'suppliers:category_detail' 'tous-les-produits' %}" class="mt-4 inline-flex items-center px-6 py-3 text-sm text-green-700 bg-green-50 hover:bg-green-100 transition-colors duration-200 rounded-lg">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                    </svg>
                    Découvrir tous nos produits
                </a>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if products.has_other_pages %}
        <div class="mt-12 flex justify-center">
            <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                {% if products.has_previous %}
                <a href="?page={{ products.previous_page_number }}" 
                   class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                    <span class="sr-only">Précédent</span>
                    <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                </a>
                {% endif %}

                {% for num in products.paginator.page_range %}
                {% if products.number == num %}
                <span class="relative inline-flex items-center px-4 py-2 border border-green-500 bg-green-50 text-sm font-medium text-green-600">
                    {{ num }}
                </span>
                {% elif num > products.number|add:'-3' and num < products.number|add:'3' %}
                <a href="?page={{ num }}" 
                   class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">
                    {{ num }}
                </a>
                {% endif %}
                {% endfor %}

                {% if products.has_next %}
                <a href="?page={{ products.next_page_number }}" 
                   class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                    <span class="sr-only">Suivant</span>
                    <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                    </svg>
                </a>
                {% endif %}
            </nav>
        </div>
        {% endif %}
    </div>
</div>

<!-- Panneau de filtres mobile -->
<div id="filtersPanel" class="fixed inset-0 z-40 bg-black bg-opacity-40 flex items-end md:items-center justify-center transition-all duration-300 hidden">
    <div class="bg-white w-full md:w-80 rounded-t-2xl md:rounded-xl p-4 max-h-[80vh] overflow-y-auto shadow-xl">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-base font-bold text-gray-900 font-bitter">Filtres</h2>
            <button onclick="toggleFilters()" class="text-gray-400 hover:text-gray-700 transition-colors duration-200">
                <span class="sr-only">Fermer</span>
                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>

        <form method="get" class="space-y-3">
            <!-- Prix -->
            <div class="bg-gray-50 rounded-lg p-3 sm:p-4">
                <button type="button" class="w-full px-2 sm:px-3 py-1 sm:py-1.5 flex items-center justify-between text-sm font-medium text-gray-900 font-bitter" onclick="toggleSection('priceSection')">
                    <span class="flex-1 text-left">Prix</span>
                    <svg class="h-4 w-4 flex-shrink-0 ml-2 transform transition-transform duration-200" id="priceSectionIcon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <div id="priceSection" class="mt-2 space-y-2 sm:space-y-3">
                    <div class="grid grid-cols-2 gap-2 sm:gap-3">
                        <div>
                            <label for="price_min" class="block text-xs sm:text-sm text-gray-600 mb-1 font-bitter">Min</label>
                            <input type="number" name="price_min" id="price_min" value="{{ selected_price_min }}" 
                                   class="w-full px-2 sm:px-3 py-1 sm:py-1.5 text-sm border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500"
                                   placeholder="Min">
                        </div>
                        <div>
                            <label for="price_max" class="block text-xs sm:text-sm text-gray-600 mb-1 font-bitter">Max</label>
                            <input type="number" name="price_max" id="price_max" value="{{ selected_price_max }}" 
                                   class="w-full px-2 sm:px-3 py-1 sm:py-1.5 text-sm border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500"
                                   placeholder="Max">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Marque -->
            {% if brands %}
            <div class="bg-gray-50 rounded-lg p-2 sm:p-3">
                <button type="button" class="w-full px-2 sm:px-3 py-1 sm:py-1.5 flex items-center justify-between text-sm font-medium text-gray-900 font-bitter" onclick="toggleSection('brandSection')">
                    <span class="flex-1 text-left">Marque</span>
                    <svg class="h-4 w-4 flex-shrink-0 ml-2 transform transition-transform duration-200" id="brandSectionIcon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <div id="brandSection" class="mt-2 space-y-1.5 sm:space-y-2 max-h-48 overflow-y-auto">
                    <div class="flex items-center">
                        <input type="radio" name="brand" id="brand_all" value="" 
                               {% if not selected_brand %}checked{% endif %}
                               class="h-3.5 w-3.5 sm:h-4 sm:w-4 text-green-600 focus:ring-green-500">
                        <label for="brand_all" class="ml-2 text-xs sm:text-sm text-gray-700">Toutes</label>
                    </div>
                    {% for brand in brands %}
                    <div class="flex items-center">
                        <input type="radio" name="brand" id="brand_{{ brand.phone__brand|slugify }}" value="{{ brand.phone__brand }}" 
                               {% if selected_brand == brand.phone__brand %}checked{% endif %}
                               class="h-3.5 w-3.5 sm:h-4 sm:w-4 text-green-600 focus:ring-green-500">
                        <label for="brand_{{ brand.phone__brand|slugify }}" class="ml-2 text-xs sm:text-sm text-gray-700">
                            {{ brand.phone__brand|default:"Marque inconnue" }}
                        </label>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Modèle -->
            {% if models %}
            <div class="bg-gray-50 rounded-lg p-2 sm:p-3">
                <button type="button" class="w-full px-2 sm:px-3 py-1 sm:py-1.5 flex items-center justify-between text-sm font-medium text-gray-900 font-bitter" onclick="toggleSection('modelSection')">
                    <span class="flex-1 text-left">Modèle</span>
                    <svg class="h-4 w-4 flex-shrink-0 ml-2 transform transition-transform duration-200" id="modelSectionIcon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <div id="modelSection" class="mt-2 space-y-1.5 sm:space-y-2 max-h-48 overflow-y-auto">
                    <div class="flex items-center">
                        <input type="radio" name="model" id="model_all" value="" 
                               {% if not selected_model %}checked{% endif %}
                               class="h-3.5 w-3.5 sm:h-4 sm:w-4 text-green-600 focus:ring-green-500">
                        <label for="model_all" class="ml-2 text-xs sm:text-sm text-gray-700">Tous</label>
                    </div>
                    {% for model in models %}
                    <div class="flex items-center">
                        <input type="radio" name="model" id="model_{{ model.phone__model|slugify }}" value="{{ model.phone__model }}" 
                               {% if selected_model == model.phone__model %}checked{% endif %}
                               class="h-3.5 w-3.5 sm:h-4 sm:w-4 text-green-600 focus:ring-green-500">
                        <label for="model_{{ model.phone__model|slugify }}" class="ml-2 text-xs sm:text-sm text-gray-700">{{ model.phone__model }}</label>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Stockage -->
            {% if storages %}
            <div class="bg-gray-50 rounded-lg p-2 sm:p-3">
                <button type="button" class="w-full px-2 sm:px-3 py-1 sm:py-1.5 flex items-center justify-between text-sm font-medium text-gray-900 font-bitter" onclick="toggleSection('storageSection')">
                    <span class="flex-1 text-left">Stockage</span>
                    <svg class="h-4 w-4 flex-shrink-0 ml-2 transform transition-transform duration-200" id="storageSectionIcon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <div id="storageSection" class="mt-2 space-y-1.5 sm:space-y-2 max-h-48 overflow-y-auto">
                    <div class="flex items-center">
                        <input type="radio" name="storage" id="storage_all" value="" 
                               {% if not selected_storage %}checked{% endif %}
                               class="h-3.5 w-3.5 sm:h-4 sm:w-4 text-green-600 focus:ring-green-500">
                        <label for="storage_all" class="ml-2 text-xs sm:text-sm text-gray-700">Tous</label>
                    </div>
                    {% for storage in storages %}
                    <div class="flex items-center">
                        <input type="radio" name="storage" id="storage_{{ storage.phone__storage|slugify }}" value="{{ storage.phone__storage }}" 
                               {% if selected_storage == storage.phone__storage %}checked{% endif %}
                               class="h-3.5 w-3.5 sm:h-4 sm:w-4 text-green-600 focus:ring-green-500">
                        <label for="storage_{{ storage.phone__storage|slugify }}" class="ml-2 text-xs sm:text-sm text-gray-700">{{ storage.phone__storage }} GB</label>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- RAM -->
            {% if rams %}
            <div class="bg-gray-50 rounded-lg p-2 sm:p-3">
                <button type="button" class="w-full px-2 sm:px-3 py-1 sm:py-1.5 flex items-center justify-between text-sm font-medium text-gray-900 font-bitter" onclick="toggleSection('ramSection')">
                    <span class="flex-1 text-left">RAM</span>
                    <svg class="h-4 w-4 flex-shrink-0 ml-2 transform transition-transform duration-200" id="ramSectionIcon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <div id="ramSection" class="mt-2 space-y-1.5 sm:space-y-2 max-h-48 overflow-y-auto">
                    <div class="flex items-center">
                        <input type="radio" name="ram" id="ram_all" value="" 
                               {% if not selected_ram %}checked{% endif %}
                               class="h-3.5 w-3.5 sm:h-4 sm:w-4 text-green-600 focus:ring-green-500">
                        <label for="ram_all" class="ml-2 text-xs sm:text-sm text-gray-700">Toutes</label>
                    </div>
                    {% for ram in rams %}
                    <div class="flex items-center">
                        <input type="radio" name="ram" id="ram_{{ ram.phone__ram|slugify }}" value="{{ ram.phone__ram }}" 
                               {% if selected_ram == ram.phone__ram %}checked{% endif %}
                               class="h-3.5 w-3.5 sm:h-4 sm:w-4 text-green-600 focus:ring-green-500">
                        <label for="ram_{{ ram.phone__ram|slugify }}" class="ml-2 text-xs sm:text-sm text-gray-700">{{ ram.phone__ram }} GB</label>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Trier par -->
            <div class="bg-gray-50 rounded-lg p-2 sm:p-3">
                <button type="button" class="w-full px-2 sm:px-3 py-1 sm:py-1.5 flex items-center justify-between text-sm font-medium text-gray-900 font-bitter" onclick="toggleSection('sortSection')">
                    <span class="flex-1 text-left">Trier par</span>
                    <svg class="h-4 w-4 flex-shrink-0 ml-2 transform transition-transform duration-200" id="sortSectionIcon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <div id="sortSection" class="mt-2 space-y-1.5 sm:space-y-2">
                    <div class="flex items-center">
                        <input type="radio" name="sort" id="sort_default" value="" 
                               {% if not selected_sort %}checked{% endif %}
                               class="h-3.5 w-3.5 sm:h-4 sm:w-4 text-green-600 focus:ring-green-500">
                        <label for="sort_default" class="ml-2 text-xs sm:text-sm text-gray-700">Par défaut</label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="sort" id="sort_price_asc" value="price_asc" 
                               {% if selected_sort == 'price_asc' %}checked{% endif %}
                               class="h-3.5 w-3.5 sm:h-4 sm:w-4 text-green-600 focus:ring-green-500">
                        <label for="sort_price_asc" class="ml-2 text-xs sm:text-sm text-gray-700">Prix croissant</label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="sort" id="sort_price_desc" value="price_desc" 
                               {% if selected_sort == 'price_desc' %}checked{% endif %}
                               class="h-3.5 w-3.5 sm:h-4 sm:w-4 text-green-600 focus:ring-green-500">
                        <label for="sort_price_desc" class="ml-2 text-xs sm:text-sm text-gray-700">Prix décroissant</label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="sort" id="sort_new" value="new" 
                               {% if selected_sort == 'new' %}checked{% endif %}
                               class="h-3.5 w-3.5 sm:h-4 sm:w-4 text-green-600 focus:ring-green-500">
                        <label for="sort_new" class="ml-2 text-xs sm:text-sm text-gray-700">Nouveautés</label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="sort" id="sort_best_selling" value="best_selling" 
                               {% if selected_sort == 'best_selling' %}checked{% endif %}
                               class="h-3.5 w-3.5 sm:h-4 sm:w-4 text-green-600 focus:ring-green-500">
                        <label for="sort_best_selling" class="ml-2 text-xs sm:text-sm text-gray-700">Meilleures ventes</label>
                    </div>
                </div>
            </div>

            <!-- Promo -->
            <div class="bg-gray-50 rounded-lg p-2 sm:p-3">
                <button type="button" class="w-full px-2 sm:px-3 py-1 sm:py-1.5 flex items-center justify-between text-sm font-medium text-gray-900 font-bitter" onclick="toggleSection('promoSection')">
                    <span class="flex-1 text-left">Promo</span>
                    <svg class="h-4 w-4 flex-shrink-0 ml-2 transform transition-transform duration-200" id="promoSectionIcon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <div id="promoSection" class="mt-2 space-y-1.5 sm:space-y-2">
                    <div class="flex items-center">
                        <input type="radio" name="promotion" id="promo_all" value="" 
                               {% if not selected_promotion %}checked{% endif %}
                               class="h-3.5 w-3.5 sm:h-4 sm:w-4 text-green-600 focus:ring-green-500">
                        <label for="promo_all" class="ml-2 text-xs sm:text-sm text-gray-700">Tous</label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="promotion" id="promo_yes" value="yes" 
                               {% if selected_promotion == 'yes' %}checked{% endif %}
                               class="h-3.5 w-3.5 sm:h-4 sm:w-4 text-green-600 focus:ring-green-500">
                        <label for="promo_yes" class="ml-2 text-xs sm:text-sm text-gray-700">En promo</label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" name="promotion" id="promo_no" value="no" 
                               {% if selected_promotion == 'no' %}checked{% endif %}
                               class="h-3.5 w-3.5 sm:h-4 sm:w-4 text-green-600 focus:ring-green-500">
                        <label for="promo_no" class="ml-2 text-xs sm:text-sm text-gray-700">Sans promo</label>
                    </div>
                </div>
            </div>

            <!-- Boutons d'action -->
            <div class="flex flex-col sm:flex-row gap-2 sm:gap-3 pt-3">
                <button type="submit" 
                        class="w-full sm:w-auto inline-flex items-center justify-center px-3 sm:px-4 py-2 sm:py-2.5 bg-green-600 text-white text-xs sm:text-sm font-medium rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md font-bitter">
                    <svg class="w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1.5 sm:mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
                    </svg>
                    <span class="whitespace-nowrap font-bitter">Filtrer</span>
                </button>
                <a href="{% url 'suppliers:brand_detail' brand|slugify %}" 
                   class="w-full sm:w-auto inline-flex items-center justify-center px-3 sm:px-4 py-2 sm:py-2.5 bg-gray-100 text-gray-700 text-xs sm:text-sm font-medium rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md font-bitter">
                    <svg class="w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1.5 sm:mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                    <span class="whitespace-nowrap font-bitter">Reset</span>
                </a>
            </div>
        </form>
    </div>
</div>

<script>
// Fonctions pour les filtres mobile
function toggleFilters() {
    const panel = document.getElementById('filtersPanel');
    panel.classList.toggle('hidden');
}

function toggleSection(sectionId) {
    const section = document.getElementById(sectionId);
    const icon = document.getElementById(sectionId + 'Icon');
    
    if (section.style.display === 'none') {
        section.style.display = 'block';
        icon.style.transform = 'rotate(180deg)';
    } else {
        section.style.display = 'none';
        icon.style.transform = 'rotate(0deg)';
    }
}

function submitMobileForm() {
    document.getElementById('mobileFiltersForm').submit();
}

// Fermer le panneau en cliquant à l'extérieur
document.getElementById('filtersPanel').addEventListener('click', function(e) {
    if (e.target === this) {
        toggleFilters();
    }
});

// Auto-dérouler les sections
const sections = ['priceSection', 'brandSection', 'modelSection', 'storageSection', 'ramSection', 'sortSection', 'promoSection'];
sections.forEach(sectionId => {
    const section = document.getElementById(sectionId);
    if (section) {
        section.style.display = 'block';
        const icon = document.getElementById(sectionId + 'Icon');
        if (icon) {
            icon.style.transform = 'rotate(180deg)';
        }
    }
});

// Gestion des filtres desktop avec auto-soumission
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('filtersForm');
    if (form) {
        const inputs = form.querySelectorAll('select, input[type="number"]');
        
        inputs.forEach(input => {
            input.addEventListener('change', function() {
                // Pour les champs de prix, attendre que l'utilisateur ait fini de taper
                if (input.type === 'number') {
                    clearTimeout(input.dataset.timeout);
                    input.dataset.timeout = setTimeout(() => {
                        updateURL();
                    }, 500);
                } else {
                    updateURL();
                }
            });
        });

        function updateURL() {
            const formData = new FormData(form);
            const params = new URLSearchParams();
            
            // Ajouter tous les paramètres non vides
            for (let [key, value] of formData.entries()) {
                if (value) {
                    params.append(key, value);
                }
            }

            // Construire la nouvelle URL
            const baseUrl = window.location.pathname;
            const newUrl = params.toString() ? `${baseUrl}?${params.toString()}` : baseUrl;
            
            // Mettre à jour l'URL sans recharger la page
            window.history.pushState({}, '', newUrl);
            
            // Soumettre le formulaire pour mettre à jour les résultats
            form.submit();
        }
    }
});
</script>
{% endblock %} 