{% extends 'base.html' %}
{% load product_tags %}

{% block title %}Résultats de recherche : {{ query }} - BoliBana{% endblock %}

{% block content %}
<!-- Facebook Pixel Search Event -->
{% if request.cookie_consent and request.cookie_consent.marketing %}
<script>
  if (typeof fbq !== 'undefined') {
    fbq('track', 'Search', {
      search_string: '{{ text|default:keywords|default:query|escapejs }}',
      content_category: '{{ category.name|default:"All"|escapejs }}'
    });
  }
</script>
{% endif %}

<div class="bg-white">
    <!-- Breadcrumb -->
    <div class="mx-auto max-w-2xl px-4 py-4 sm:px-6 lg:max-w-7xl lg:px-8">
        {% include "suppliers/components/breadcrumb.html" %}
    </div>

    <div class="mx-auto max-w-2xl px-4 py-16 sm:px-6 sm:py-24 lg:max-w-7xl lg:px-8">
        <!-- En-tête et statistiques combinés -->
        {% if products %}
        <div class="mb-6">
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-6">
                        <!-- Titre et statistiques simplifiés -->
                        <div>
                            <h1 class="text-xl sm:text-2xl font-bold text-gray-900">
                                Votre recherche : {{ text|default:keywords|default:query }}
                            </h1>
                            <p class="text-lg text-gray-600 mt-1">
                                {{ total_results }} produits
                            </p>
                        </div>
                    </div>
                    
                    <!-- Nouvelle recherche -->
                    <div class="flex items-center space-x-2">
                        <a href="{% url 'suppliers:search' %}" 
                           class="flex items-center px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 transition-colors duration-200">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                            </svg>
                            Nouvelle recherche
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- Filtres -->
        {% if products %}
        <div class="mb-6">
            {% include "suppliers/components/_search_filters.html" %}
        </div>
        {% endif %}
        
        <!-- Résultats -->
        {% if products %}
            <!-- Grille des produits -->
            <div class="min-h-[500px]">
                <div class="grid grid-cols-2 gap-2 sm:gap-4 md:grid-cols-3 lg:grid-cols-4">
                    {% for product in products %}
                        {% render_product_card product %}
                    {% empty %}
                    <div class="col-span-full text-center py-12">
                        <p class="text-gray-500 text-xl">Aucun produit trouvé pour cette recherche.</p>
                        <a href="{% url 'suppliers:supplier_index' %}" class="mt-4 inline-flex items-center px-6 py-3 text-sm text-green-700 bg-green-50 hover:bg-green-100 transition-colors duration-200 rounded-lg">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                            </svg>
                            Découvrir tous nos produits
                        </a>
                    </div>
                    {% endfor %}
                </div>
            </div>
        {% else %}
            <div class="bg-white rounded-lg shadow p-6 sm:p-8 text-center">
                <div class="w-16 h-16 mx-auto mb-4 text-gray-400">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                </div>
                <h1 class="text-xl sm:text-2xl font-bold text-gray-900 mb-2">
                    Votre recherche : {{ text|default:keywords|default:query }}
                </h1>
                <p class="text-gray-500 text-base sm:text-lg mb-2">Aucun produit trouvé</p>
                <p class="text-gray-400 text-sm mb-4">Essayez avec d'autres mots-clés</p>
                
                <!-- Suggestions de recherche -->
                <div class="flex flex-wrap justify-center gap-2">
                    <a href="/search/results/?text=iPhone&keywords=iPhone" 
                       class="px-3 py-1 text-sm bg-green-100 text-green-700 rounded-full hover:bg-green-200 transition-colors duration-200">
                        iPhone
                    </a>
                    <a href="/search/results/?text=Samsung&keywords=Samsung" 
                       class="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded-full hover:bg-blue-200 transition-colors duration-200">
                        Samsung
                    </a>
                    <a href="/search/results/?text=Téléphone&keywords=Téléphone" 
                       class="px-3 py-1 text-sm bg-yellow-100 text-yellow-700 rounded-full hover:bg-yellow-200 transition-colors duration-200">
                        Téléphone
                    </a>
                    <a href="/search/results/?text=Ordinateur&keywords=Ordinateur" 
                       class="px-3 py-1 text-sm bg-purple-100 text-purple-700 rounded-full hover:bg-purple-200 transition-colors duration-200">
                        Ordinateur
                    </a>
                </div>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %} 