{% if product and product.id and product.id != '' and product.id != None %}
<form hx-post="{% url 'add_to_cart' product.id %}"
      hx-target="#cart-count"
      hx-swap="none"
      class="space-y-6">
    
    {% if colors %}
    <div class="mt-4">
        <label class="block text-sm font-medium text-gray-700 mb-2">Couleur</label>
        <div class="grid grid-cols-4 gap-2">
            {% for color in colors %}
            <label class="relative">
                <input type="radio" 
                       name="color_id" 
                       value="{{ color.id }}"
                       class="peer absolute opacity-0"
                       required>
                <div class="p-2 text-sm border rounded-lg cursor-pointer 
                           bg-white text-center transition-all duration-200
                           peer-checked:bg-green-50 peer-checked:border-green-500 
                           peer-checked:text-green-600 hover:bg-gray-50">
                    {{ color.name }}
                </div>
            </label>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if product_sizes %}
    <div class="mt-4">
        <label class="block text-sm font-medium text-gray-700 mb-2">Taille</label>
        <div class="grid grid-cols-4 gap-2">
            {% for size in product_sizes %}
            <label class="relative">
                <input type="radio" 
                       name="size_id" 
                       value="{{ size.id }}"
                       class="peer absolute opacity-0"
                       required>
                <div class="p-2 text-sm border rounded-lg cursor-pointer 
                           bg-white text-center transition-all duration-200
                           peer-checked:bg-green-50 peer-checked:border-green-500 
                           peer-checked:text-green-600 hover:bg-gray-50">
                    {{ size.name }}
                </div>
            </label>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Message d'erreur -->
    <div id="error-message" class="hidden text-red-600 text-sm mt-2"></div>

    <!-- Bouton d'ajout au panier -->
    <button type="submit"
            class="w-full bg-gradient-to-r from-green-600 to-yellow-500 
                   text-white py-3 px-4 rounded-lg 
                   hover:from-green-700 hover:to-yellow-600 
                   transition-all duration-300 flex items-center justify-center">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
        </svg>
        Ajouter au panier
    </button>
</form>

<script>
document.addEventListener('htmx:afterRequest', function(evt) {
    if (evt.detail.xhr.status === 400) {
        const errorMessage = document.getElementById('error-message');
        errorMessage.textContent = evt.detail.xhr.responseText;
        errorMessage.classList.remove('hidden');
        setTimeout(() => {
            errorMessage.classList.add('hidden');
        }, 3000);
    } else if (evt.detail.xhr.status === 200) {
        // Si nous sommes dans le cart sidebar, fermons-le
        if (document.getElementById('cart-sidebar').classList.contains('active')) {
            closeProductOptions();
        }
    }
});
</script>
{% else %}
<!-- Produit invalide -->
<div class="text-center text-gray-500 py-4">
    <p>Produit non disponible</p>
</div>
{% endif %} 