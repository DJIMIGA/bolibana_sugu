{% extends 'base.html' %}
{% load static %}
{% block title %}<title>Products list</title>{% endblock %}
{% block content %}


<div class="bg-white hidden">
  <div class="pt-6">
    <nav aria-label="Breadcrumb">
      <ol role="list" class="mx-auto flex max-w-2xl items-center space-x-2 px-4 sm:px-6 lg:max-w-7xl lg:px-8">
        <li>
          <div class="flex items-center">
            <a href="#" class="mr-2 text-sm font-medium text-gray-900">men</a>
            <svg width="16" height="20" viewBox="0 0 16 20" fill="currentColor" aria-hidden="true" class="h-5 w-4 text-gray-300">
              <path d="M5.697 4.34L8.98 16.532h1.327L7.025 4.341H5.697z" />
            </svg>
          </div>
        </li>
        <li>
          <div class="flex items-center">
            <a href="#" class="mr-2 text-sm font-medium text-gray-900">Clothing</a>
            <svg width="16" height="20" viewBox="0 0 16 20" fill="currentColor" aria-hidden="true" class="h-5 w-4 text-gray-300">
              <path d="M5.697 4.34L8.98 16.532h1.327L7.025 4.341H5.697z" />
            </svg>
          </div>
        </li>

        <li class="text-sm">
          <a href="#" aria-current="page" class="font-medium text-gray-500 hover:text-gray-600">{{ product.title }}</a>
        </li>
      </ol>
    </nav>

    <!-- Image gallery -->
    <div class="mx-auto mt-6 max-w-2xl sm:px-6 lg:grid lg:max-w-7xl lg:grid-cols-3 lg:gap-x-8 lg:px-8">
      <!-- Image principale -->
      {% with first_image=images.first %}
      {% if first_image %}
      <img src="{{ first_image.image.url }}" alt="{{ product.title }}"
           class="hidden size-full rounded-lg object-cover lg:block">
      {% endif %}
      {% endwith %}

      <div class="hidden lg:grid lg:grid-cols-1 lg:gap-y-8">
        {% for image in images %}
        {% if forloop.counter <= 2 %}
        <img src="{{ image.image.url }}" alt="{{ product.title }}" class="aspect-3/2 w-full rounded-lg object-cover">
        {% endif %}
        {% endfor %}
      </div>

      <!-- Afficher les autres images -->
      {% for image in images %}
      {% if forloop.counter > 2 %}
      <img src="{{ image.image.url }}" alt="{{ product.title }}"
           class="aspect-4/5 size-full object-cover sm:rounded-lg lg:aspect-auto">
      {% endif %}
      {% endfor %}
    </div>
    <!-- Product info -->
    <div class="mx-auto max-w-2xl px-4 pb-16 pt-10 sm:px-6 lg:grid lg:max-w-7xl lg:grid-cols-3 lg:grid-rows-[auto_auto_1fr] lg:gap-x-8 lg:px-8 lg:pb-24 lg:pt-16">
      <div class="lg:col-span-2 lg:border-r lg:border-gray-200 lg:pr-8">
        <h1 class="text-2xl font-bold tracking-tight text-gray-900 sm:text-3xl">{{ product.title }}</h1>
      </div>

      <!-- Options -->
      <div class="mt-4 lg:row-span-3 lg:mt-0">
        <h2 class="sr-only">Product information</h2>
        <p class="text-3xl tracking-tight text-gray-900">{{product.price|floatformat:0}}Fcfa</p>
        <div class="mt-6">
          <h3 class="sr-only">Reviews</h3>
          <div class="flex items-center">
            <div class="flex items-center">
              {% for i in "12345" %}
              {% if forloop.counter <= average_rating|floatformat:"0"|add:"0" %}
              <svg class="size-5 shrink-0 text-gray-900" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"
                   data-slot="icon">
                <path fill-rule="evenodd"
                      d="M10.868 2.884c-.321-.772-1.415-.772-1.736 0l-1.83 4.401-4.753.381c-.833.067-1.171 1.107-.536 1.651l3.62 3.102-1.106 4.637c-.194.813.691 1.456 1.405 1.02L10 15.591l4.069 2.485c.713.436 1.598-.207 1.404-1.02l-1.106-4.637 3.62-3.102c.635-.544.297-1.584-.536-1.65l-4.752-.382-1.831-4.401Z"
                      clip-rule="evenodd"/>
              </svg>
              {% else %}
              <svg class="size-5 shrink-0 text-gray-200" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"
                   data-slot="icon">
                <path fill-rule="evenodd"
                      d="M10.868 2.884c-.321-.772-1.415-.772-1.736 0l-1.83 4.401-4.753.381c-.833.067-1.171 1.107-.536 1.651l3.62 3.102-1.106 4.637c-.194.813.691 1.456 1.405 1.02L10 15.591l4.069 2.485c.713.436 1.598-.207 1.404-1.02l-1.106-4.637 3.62-3.102c.635-.544.297-1.584-.536-1.65l-4.752-.382-1.831-4.401Z"
                      clip-rule="evenodd"/>
              </svg>
              {% endif %}
              {% endfor %}
            </div>
            <p class="sr-only">{{ average_rating|floatformat:1 }} out of 5 stars</p>
            <a href="{% url 'product:add_review' product.id %}" class="ml-3 text-sm font-medium text-indigo-600 hover:text-indigo-500">{{ reviews.count }} avis</a>
          </div>
        </div>
      </div>

      <div class="py-10 lg:col-span-2 lg:col-start-1 lg:border-r lg:border-gray-200 lg:pb-16 lg:pr-8 lg:pt-6">
        <!-- Description and details -->
        <div>
          <h3 class="sr-only">Description</h3>

          <div class="space-y-6">
            <p class="text-base text-gray-900">{{product.description}}</p>
          </div>
        </div>
        {% if product.get_highlights %}
        <div class="mt-10">
          <h3 class="text-sm font-medium text-gray-900">Highlights</h3>

          <div class="mt-4">
            <ul role="list" class="list-disc space-y-2 pl-4 text-sm">
              {% for item in product.get_highlights %}
              <li class="text-gray-400"><span class="text-gray-600">{{ item }}</span></li>
              {% endfor %}
            </ul>
          </div>
          {% endif %}
</div>


        {% if product.detail %}
        <div class="mt-10">
          <h3 class="text-sm font-medium text-gray-900">Details</h3>
          <div class="mt-4 text-sm text-gray-600">
            {{ product.detail }}
          </div>
        </div>
        {% endif %}

      </div>
    </div>
  </div>
</div>



<div class="bg-white">
  <div class="pt-6">
    <nav aria-label="Breadcrumb">
      <ol role="list" class="mx-auto flex max-w-2xl items-center space-x-2 px-4 sm:px-6 lg:max-w-7xl lg:px-8">
        <li>
          <div class="flex items-center">
            <a href="#" class="mr-2 text-sm font-medium text-gray-900">men</a>
            <svg width="16" height="20" viewBox="0 0 16 20" fill="currentColor" aria-hidden="true" class="h-5 w-4 text-gray-300">
              <path d="M5.697 4.34L8.98 16.532h1.327L7.025 4.341H5.697z" />
            </svg>
          </div>
        </li>
        <li>
          <div class="flex items-center">
            <a href="#" class="mr-2 text-sm font-medium text-gray-900">Clothing</a>
            <svg width="16" height="20" viewBox="0 0 16 20" fill="currentColor" aria-hidden="true" class="h-5 w-4 text-gray-300">
              <path d="M5.697 4.34L8.98 16.532h1.327L7.025 4.341H5.697z" />
            </svg>
          </div>
        </li>

        <li class="text-sm">
          <a href="#" aria-current="page" class="font-medium text-gray-500 hover:text-gray-600">{{ product.title }}</a>
        </li>
      </ol>
    </nav>
  <div class="max-w-2xl mx-auto py-16 px-4 sm:py-20 sm:px-6 lg:max-w-7xl lg:px-8">
    <div class="lg:grid lg:grid-cols-2 lg:gap-x-8 lg:items-start">
      <!-- Image gallery -->
      <div class="flex flex-col-reverse">
  <!-- Sélecteur d'images -->
  <div class="mt-6 w-full max-w-2xl mx-auto sm:block lg:max-w-none">
    {% if images %}
    <div class="grid grid-cols-4 gap-6" aria-orientation="horizontal" role="tablist">
      {% for image in images %}
      <button id="tabs-1-tab-{{ forloop.counter }}"
              class="relative h-24 bg-white rounded-md flex items-center justify-center text-sm font-medium uppercase text-gray-900 cursor-pointer hover:bg-gray-50 focus:outline-none focus:ring focus:ring-offset-4 focus:ring-opacity-50"
              aria-controls="tabs-1-panel-{{ forloop.counter }}"
              role="tab"
              type="button"
              onclick="changeMainImage('{{ image.image.url }}', this)">
        <span class="sr-only">Vue {{ forloop.counter }}</span>
        <span class="absolute inset-0 rounded-md overflow-hidden">
          <img src="{{ image.image.url }}" alt="{{ product.title }}" class="w-full h-full object-center object-cover">
        </span>
        <span class="ring-transparent absolute inset-0 rounded-md ring-2 ring-offset-2 pointer-events-none" aria-hidden="true"></span>
      </button>
      {% endfor %}
    </div>
    {% endif %}
  </div>
 
  <!-- Image principale -->
   {% with first_image=images.first %}
   {% if first_image %}
   <div class="aspect-w-1 aspect-h-1 mb-4">
     <div id="main-image-container" class="w-full h-full">
       <img id="main-image" src="{{ first_image.image.url }}" alt="{{ product.title }}" class="w-full h-full object-center object-cover sm:rounded-lg">
     </div>
   </div>
   {% endif %}
   {% endwith %}
</div>

      <!-- Product info -->
      <div class="mt-10 px-4 sm:px-0 sm:mt-16 lg:mt-0">
        <h1 class="text-3xl font-extrabold tracking-tight text-gray-900">{{ product.title }}</h1>

        <div class="mt-3">
          <h2 class="sr-only">Product information</h2>
          <p class="text-3xl text-gray-900">{{ product.price|floatformat:0 }} Fcfa</p>
        </div>

        <!-- Reviews -->
          <div class="mt-6">
          <h3 class="sr-only">Reviews</h3>
          <div class="flex items-center">
            <div class="flex items-center">
              {% for i in "12345" %}
              {% if forloop.counter <= average_rating|floatformat:"0"|add:"0" %}
              <svg class="size-5 shrink-0 text-gray-900" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"
                   data-slot="icon">
                <path fill-rule="evenodd"
                      d="M10.868 2.884c-.321-.772-1.415-.772-1.736 0l-1.83 4.401-4.753.381c-.833.067-1.171 1.107-.536 1.651l3.62 3.102-1.106 4.637c-.194.813.691 1.456 1.405 1.02L10 15.591l4.069 2.485c.713.436 1.598-.207 1.404-1.02l-1.106-4.637 3.62-3.102c.635-.544.297-1.584-.536-1.65l-4.752-.382-1.831-4.401Z"
                      clip-rule="evenodd"/>
              </svg>
              {% else %}
              <svg class="size-5 shrink-0 text-gray-200" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"
                   data-slot="icon">
                <path fill-rule="evenodd"
                      d="M10.868 2.884c-.321-.772-1.415-.772-1.736 0l-1.83 4.401-4.753.381c-.833.067-1.171 1.107-.536 1.651l3.62 3.102-1.106 4.637c-.194.813.691 1.456 1.405 1.02L10 15.591l4.069 2.485c.713.436 1.598-.207 1.404-1.02l-1.106-4.637 3.62-3.102c.635-.544.297-1.584-.536-1.65l-4.752-.382-1.831-4.401Z"
                      clip-rule="evenodd"/>
              </svg>
              {% endif %}
              {% endfor %}
            </div>
            <p class="sr-only">{{ average_rating|floatformat:1 }} out of 5 stars</p>
            <a href="{% url 'product:add_review' product.id %}" class="ml-3 text-sm font-medium text-indigo-600 hover:text-indigo-500">{{ reviews.count }} avis</a>
          </div>
        </div>

        <div class="mt-6">
          <h3 class="sr-only">Description</h3>

          <div class="text-base text-gray-700 space-y-6">
            <p>{{product.description}}</p>
          </div>
        </div>

        <div class="mt-6">
            {% include 'cart/components/_product_options.html' %}
        </div>

        <section aria-labelledby="details-heading" class="mt-12">
          <h2 id="details-heading" class="sr-only">Additional details</h2>
          {% if product.get_highlights %}
          <div class="border-t divide-y divide-gray-200">
            <details class="group">
              <summary class="w-full py-6 flex justify-between items-center text-left cursor-pointer list-none">
                <span class="text-gray-900 text-sm font-medium"> Détails sur votre produit </span>
                <span class="ml-6 flex items-center">
                  <!-- Icône + (affiché quand fermé) -->
                  <svg class="h-6 w-6 text-gray-400 group-open:hidden" xmlns="http://www.w3.org/2000/svg" fill="none"
                       viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                  </svg>
                  <!-- Icône - (affiché quand ouvert) -->
                  <svg class="hidden h-6 w-6 text-indigo-400 group-open:block" xmlns="http://www.w3.org/2000/svg"
                       fill="none"
                       viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 12H6"/>
                  </svg>
                </span>
              </summary>
              <div class="pb-6 prose prose-sm">
                <ul role="list">
                  {% for item in product.get_highlights %}
                  <li>{{ item }}</li>
                  {% endfor %}
                </ul>
              </div>
            </details>
          </div>
          {% endif %}
          <div class="border-t divide-y divide-gray-200">
            <details class="group">
              <summary class="w-full py-6 flex justify-between items-center text-left cursor-pointer list-none">
                <span class="text-gray-900 text-sm font-medium"> Livraison </span>
                <span class="ml-6 flex items-center">
                  <!-- Icône + (affiché quand fermé) -->
                  <svg class="h-6 w-6 text-gray-400 group-open:hidden" xmlns="http://www.w3.org/2000/svg" fill="none"
                       viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                  </svg>
                  <!-- Icône - (affiché quand ouvert) -->
                  <svg class="hidden h-6 w-6 text-indigo-400 group-open:block" xmlns="http://www.w3.org/2000/svg"
                       fill="none"
                       viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 12H6"/>
                  </svg>
                </span>
              </summary>
              <div class="pb-6 prose prose-sm">
                <ul role="list">
                  {% for item in shipping_method %}
                  <li>{{ item.name }}</li>
                  {% endfor %}
                </ul>
              </div>
            </details>
          </div>
          <div class="border-t divide-y divide-gray-200">
            <details class="group">
              <summary class="w-full py-6 flex justify-between items-center text-left cursor-pointer list-none">
                <span class="text-gray-900 text-sm font-medium"> Retours et remboursements </span>
                <span class="ml-6 flex items-center">
                  <!-- Icône + (affiché quand fermé) -->
                  <svg class="h-6 w-6 text-gray-400 group-open:hidden" xmlns="http://www.w3.org/2000/svg" fill="none"
                       viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                  </svg>
                  <!-- Icône - (affiché quand ouvert) -->
                  <svg class="hidden h-6 w-6 text-indigo-400 group-open:block" xmlns="http://www.w3.org/2000/svg"
                       fill="none"
                       viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 12H6"/>
                  </svg>
                </span>
              </summary>
              <div class="pb-6 prose prose-sm">
                <ul role="list">
                  <li>Demandes de retour faciles</li>
                  <li>Délai de retour de 14 jours</li>
                  <li>Retours gratuits</li>
                </ul>
              </div>
            </details>
          </div>
        </section>
      </div>
    </div>
  </div>
  </div>
</div>


{% include 'review.html' %}


{% block scripts %}
{{ block.super }}  <!-- Cela inclut le script de base -->
<script src="{% static 'product/js/script.js' %}"></script>
<script>
document.body.addEventListener('htmx:beforeSwap', function(evt) {
    if (evt.detail.xhr.status === 400) {
        // Empêcher le swap par défaut
        evt.detail.shouldSwap = false;
        
        // Afficher le message d'erreur
        const errorDiv = document.getElementById('error-message');
        errorDiv.textContent = evt.detail.xhr.response;
        errorDiv.classList.remove('hidden');
        
        // Cacher le message après 3 secondes
        setTimeout(() => {
            errorDiv.classList.add('hidden');
        }, 3000);
    }
});

function changeMainImage(url, button) {
  const mainImage = document.getElementById('main-image');
  if (mainImage) {
    mainImage.src = url;
  }
  
  // Mettre à jour l'état actif du bouton
  const buttons = document.querySelectorAll('[role="tab"]');
  buttons.forEach(btn => {
    btn.classList.remove('ring-indigo-500');
    btn.classList.add('ring-transparent');
  });
  button.classList.remove('ring-transparent');
  button.classList.add('ring-indigo-500');
}
</script>
{% endblock %}

{% endblock %}